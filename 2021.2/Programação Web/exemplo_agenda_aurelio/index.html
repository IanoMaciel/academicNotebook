<!DOCTYPE HTML>
<html>
	<!--
		@Autor Aurélio Menezes
		Exemplo de código HTML5 para criar uma agenda telefônica
		
	-->
	<head>
	<meta charset="UTF-8" />
	<title>Agenda on-line</title>
	
	<style type="text/css">
		body {font-family: Helvetica, sans-serif; font-size: 100%; line-height: 1.4em}
		input, button {width: 25em; font-size: 100%; padding: .25em}
	</style>
	
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">
		// Erro genérico de callback para transações de banco de dados
		var errCallback = function(){
			alert("Há um erro de banco de dados!");
		}
	
		// Abrir / inicializar o banco de dados - isso vai falhar em navegadores como firefox e IE
		var db = openDatabase("agenda", "1.0", "Agenda on-line", 32678);
	 
		// Criar a tabela de contatos se necessário
		db.transaction(function(transaction){
			transaction.executeSql("CREATE TABLE IF NOT EXISTS contatos (" +
				"id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT," +
				"nome TEXT NOT NULL, telefone INTEGER NOT NULL, endereço TEXT NOT NULL);");
		});
	
		// Essa é a função salvar
		var salvarcontato = function(nome, telefone, endereço, successCallback){
			db.transaction(function(transaction){
				transaction.executeSql(("INSERT INTO contatos (nome, telefone, endereço) VALUES (?, ?, ?);"), 
				[nome, telefone, endereço], function(transaction, results){successCallback(results);}, errCallback);
			});
		};
		
		// Esta é uma função de carga, que carrega todos os contatos para um determinado local
		var carregacontato = function(nome, successCallback){
			db.transaction(function(transaction){
				transaction.executeSql(("SELECT * FROM contatos WHERE nome=?"), [nome],
					function(transaction, results){successCallback(results);}, errCallback);
				});
		};
	
		// evento documento okay
		$(function(){
			var form = $("form");
		
			// Callback ao carregar dados 
			var atualizapagina = function(results){
				var list = $("#nome-lista");
				list.empty();
				console.dir(results);
				if (results.rows.length==0){
					alert("Não há nomes aqui.");
				} else {
					$.each(results.rows, function(rowIndex){
						var linha = results.rows.item(rowIndex);
list.append( "<li>" + linha.nome + ", " + linha.telefone + ", " + linha.endereço + "</li>");
					});
				}
			};
		 
			// Substituir o formulário padrão apresentar em favor do nosso código
			form.submit(function(event){
				event.preventDefault();
				salvarcontato($('#nome').val(), $('#telefone').val(), $('#endereço').val(), function(){
					alert("dados do contato " + $('#nome').val() + " salvos!");
				})
			});
			
			// Lista de contatos vinculados a um botão na página
			$('#mostre-me').click(function(){carregacontato($('#onde').val(), atualizapagina);});
		});

function recuperar()

{


 db.transaction( function (tx) {
    tx.executeSql(
       'SELECT * FROM contatos',
       [],
       function (tx, results)
       {
          var len = results.rows.length;
          alert('Existem ' + len + ' registros!');
          for (var i = 0; i < len; i++)
          {
             var row = results.rows.item(i);
             alert(row.id + ': ' + row.nome);
          }
       },
       function (tx, error)
       {
          alert('ooops ' + error.message);
       }
       );
 });
 }


	</script>
</head>
 
<body>
	<h1>Agenda on-line</h1>
	 
	<form>
		<h2>nome, telefone e endereço</h2>
		<p><input type="text" id="nome" name="nome" class="name" placeholder="digite o contato aqui" /></p>
		<p><input type="text" id="telefone" name="telefone" class="telefone" placeholder="digite o telefone aqui" /></p>
		<p><input type="text" id="endereço" name="endereço" class="endereço" placeholder="digite o endereço aqui" /></p>
		<p><input type="submit" value="Salvar contato" /></p>
	</form>
	
	<p>Digite um nome abaixo e depois clique no botão para ver os resultados:</p>
	<p><input id="onde" name="onde" placeholder="Nome para checar" /></p>
	<p><input type="button" id="mostre-me" value="mostre-me os contatos!" /></p>
 
	<h2>Lista de contatos</h2>
	<ul id="nome-lista"><!-- atualiza a pagina --></ul>

<p>Clique no botão para recuperar dados em um banco de dados web sql.</p>


         <button onclick="recuperar()">Pressione-me para ver todos</button>
</body>
</html>